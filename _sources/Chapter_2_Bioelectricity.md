---
jupytext:
  text_representation:
    extension: .md
    format_name: myst
    format_version: 0.13
    jupytext_version: 1.11.5
kernelspec:
  display_name: Python 3
  language: python
  name: python3
---

# Chapter 2: Bioelectricity

```{caution} This book was initially prepared on short notice and is an ongoing, ever-evolving project. Many of the ideas, simulations, and visualizations here are incomplete, and most are missing citations. If you feel that I have neglected to cite the proper sources, please do not be offended. It is more than likely that I am in the processes of adding the relevant citations.
```

```{code-cell} ipython3
:tags: [remove-cell]
# Scientific computing
import pandas as pd
import numpy as np

# Web friendly plotting with Bokeh
from bokeh.models import ColorBar, ColumnDataSource, Title, BoxAnnotation, Span, Legend, LabelSet, CategoricalColorMapper
from bokeh.palettes import Viridis256, Magma256, Turbo256, Cividis256, Colorblind
from bokeh.plotting import figure, output_file, show
from bokeh.transform import linear_cmap, cumsum, CumSum
from bokeh.layouts import row, gridplot, layout
import bokeh.io
bokeh.io.output_notebook()

# Matplotlib, for when Bokeh fails
import matplotlib.pyplot as plt
from matplotlib import ticker
```

```{toggle}
$$
\require{color}
% Colorblind pallette
\definecolor{Indigo}{RGB}{51, 34, 136}
\definecolor{Cyan}{RGB}{136, 204, 238}
\definecolor{Teal}{RGB}{68, 170, 153}
\definecolor{Green}{RGB}{17, 119, 51}
\definecolor{Olive}{RGB}{153, 153, 51}
\definecolor{Sand}{RGB}{221, 204, 119}
\definecolor{Rose}{RGB}{204, 102, 119}
\definecolor{Wine}{RGB}{136, 34, 85}
\definecolor{Purple}{RGB}{170, 68, 153}
$$
```

+++

## A Primer on Electricity

### Electric Charges

### Electric Potential

### Electrical Circuits

#### Batteries

#### Resistors

#### Capacitors

+++

## Electrical Phenomena in Biology

Now that we have some idea about how electricity and electrical circuits work, how can we use this knowledge to understand electrical phenomena in living systems? As we discussed in the first chapter, one of the key aspects of modeling is metaphor. By constructing an analogy between something we're less familiar with and something we're more familiar with, we can use what we know about the more familiar phenomenon to understand the less familiar one on the basis of qualitative similarities between them. 

Here, our goal will be to construct an analogy between electrical circuits and living cells. I could just outright tell you what those analogies are, and we could proceed to analyzing the resultant models. But if the qualitative similarities between cells and circuits are not obvious to you, doing so would just be confusing. Instead, we'll take a constructive approach, building up experimental results and theoretical concepts until the analogy becomes obvious. Our method will be to construct a set of analogies between electrical circuit elements and components of cells.

+++

## The Nernst Potential


```{code-cell} ipython3 
:tags: [hide-cell]
def NernstPotential(z, T, C_in, C_out):
    '''
    Computes the Nernst equation for a single ion species
    
    Inputs
        z: float
            The valence (charge) of the ion species
        T: float
            The temperature in Kelvin
        C_in: float
            The intracellular ion concentration
        C_out: float
            The extracellular ion concentration
    
    Outputs
        The Nernst potential for the ion species in millivolts (mV)
    '''
    # Universal gas constant
    R = 8.31446261815324    # J / K*mol
    
    # Faraday's constant
    F = 96485.3321233100184 # C / mol
    
    # Nernst equation
    return ((R*T) / (z*F)) * np.log(C_out / C_in) * 1e3


def PlotNernstPoints(C_frac, V_rev):
    fig = figure(width=500, 
                 height=500,
                 x_axis_type="log",
                 y_range=(V_rev.min()-10, V_rev.max()+10),
                 background_fill_color="#fffff1")
    fig.circle(C_frac, V_rev, size=10, color="#111111")
    fig.xaxis.axis_label = r"$$ \frac{\left[\textsf{Na}^+ \right]_o}{\left[\textsf{Na}^+ \right]_i} $$"
    fig.yaxis.axis_label = r"$$\textsf{Reversal Potential (mV)}$$"
    return fig
```

```{code-cell} ipython3 
:tags: [hide-cell]
# Compute Nernst potential for sodium at increasing extracellular concentration

# Physiological temperature (37 deg Celsius, 310.15 Kelvin)
T_phys =  310.15
# Extracellular sodium concentration
Na_out = np.array([1e-1, 1, 1e1, 1e2])
# Nernst potential
Na_reversal = NernstPotential(1, T_phys, 1, Na_out)
```

```{code-cell} ipython3 
:tags: [hide-cell]
# Call the plotting function
Na_rev_plot = PlotNernstPoints(Na_out, Na_reversal)
```

```{code-cell} ipython3 
:tags: [hide-input]
# Display the plot
bokeh.io.show(Na_rev_plot)
```

Here's the Nernst equation for the electrochemical potential generated by separating ions of a single species $A$ with valence $z$ across an impermeable membrane (remember to hover your cursor over the different symbols in the equation to see what they are):

$$ 
\Large \texttip{E_{A^z}}{The electrochemical potential of the ion species} = \frac{RT}{zF} \log \left( \frac{[A^z]_o}{[A^z]_i} \right ) 
$$

Woah, that's a lot of symbols! We can break it down to better understand the bits and pieces. If we group some of these symbols together, as we have done using color in the equations below, we can see that the Nernst equation has the same form as the equation of a line:

$$ 
\Large \color{Purple} E_{A^z} \color{black} = \color{Teal} \frac{RT}{zF} \color{Olive} \log \left( \frac{[A^z]_o}{[A^z]_i} \right ) 
$$

$$\Large \downarrow$$

$$ \Large \color{Purple} y \color{black} = \color{Teal} m \color{Olive} x \color{black} + \color{Rose}b $$  

+++

## The Resting Membrane Potential

+++

## The Cell Membrane as Capacitor

+++

## Ion Channels as Resistors

+++

## A Menagerie of Ion Channels


```{code-cell} ipython3

```
